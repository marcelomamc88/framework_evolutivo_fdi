% INTERACT SIMULINK MODEL FROM A MATLAB SCRIPT
%https://www.youtube.com/watch?v=sF_sjFqNFUk

clear
clc
close all

%% DEFAULT VALUES - NO FAULT

% ALTITUDE MANUEVER
input.altitude.amplitude = 0;
input.altitude.timestart = 0;
input.altitude.timeend = 0;

% FAULT BETA
input.beta.amplitude = 0;
input.beta.time = 0;

% FAULT BP
input.bp.amplitude = 0;
input.bp.time = 20;

% FAULT C LEAK
input.c_leak.amplitude = 0;
input.c_leak.time = 0;

% FAULT VALVE POSITION
input.valve.fault = 0;
input.valve.amplitude = 0;
input.valve.time = 0;

%run the simulink model using the 'sim' command
sim('F16_DS1_ALTITUDE_SIMULINK.slx')

%extract the data generated by the simulink model
output_arr = ans.simout_arr;

% downsample through Hamming Window (fir)
factor = 100;
read_1 = decimate(output_arr(:,1), factor,'fir');
output_reduced = zeros(size(read_1, 1), 25);
output_reduced(:,1) = read_1;
for i=2:size(output_arr,2)
    output_reduced(:,i) = decimate(output_arr(:,i), factor,'fir');   
end

% save in file
writematrix(output_reduced, 'normal.csv','WriteMode','append')


